"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var tslib_1 = require("tslib");
var docker_1 = require("../../docker");
var semver = require('semver');
function extract(targetImage, options) {
    return tslib_1.__awaiter(this, void 0, void 0, function () {
        var binaryVersion, error_1, stderr;
        return tslib_1.__generator(this, function (_a) {
            switch (_a.label) {
                case 0:
                    _a.trys.push([0, 2, , 3]);
                    return [4 /*yield*/, new docker_1.Docker(targetImage, options)
                            .run('node', ['--version'])];
                case 1:
                    binaryVersion = (_a.sent()).stdout;
                    return [2 /*return*/, parseNodeBinary(binaryVersion)];
                case 2:
                    error_1 = _a.sent();
                    stderr = error_1.stderr;
                    if (typeof stderr === 'string' && stderr.indexOf('not found') >= 0) {
                        return [2 /*return*/, null];
                    }
                    throw new Error(stderr);
                case 3: return [2 /*return*/];
            }
        });
    });
}
exports.extract = extract;
function parseNodeBinary(version) {
    var nodeVersion = semver.valid(version && version.trim());
    if (!nodeVersion) {
        return null;
    }
    return {
        name: 'node',
        version: nodeVersion,
    };
}
var packageNames = ['node', 'nodejs'];
function installedByPackageManager(installedPackages, pkgManager) {
    return installedPackages
        .filter(function (pkg) { return packageNames.indexOf(pkg) > -1; }).length > 0;
}
exports.installedByPackageManager = installedByPackageManager;
//# sourceMappingURL=node.js.map